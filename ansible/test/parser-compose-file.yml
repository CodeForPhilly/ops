version: '2'

services:

  http-router:
    build: ../../images/haproxy-http-router
    volumes:
      - router-config:/usr/local/etc/haproxy
    networks:
      system:
    ports:
      - '${HTTP_PORT}:80'
    labels:
      civic-cloud.route: example.net/foo/
      civic-cloud.route.1: example.org/foo/

  static-http:
    image: nginx:1.19
    volumes:
      - static-data:/usr/share/nginx/html
    expose:
      - 443
    networks:
      system:
        aliases:
          - static-http.system.domain
    labels:
      civic-cloud.route.0: example.net/bar/
      civic-cloud.route.1: example.org/bar/:80

volumes:
  router-config:
    labels:
      civic-cloud.import.src: http-router:/usr/local/etc/haproxy
      civic-cloud.size: 2G
      civic-cloud.route: example.com
  static-data:
    labels:
      civic-cloud.size: 8G
      civic-cloud.import.src: static-http:/usr/share/nginx/html
      civic-cloud.import.1.src: https://example.com/overlay.zip
      civic-cloud.import.1.destroy: true
  ignored-vol:
    civic-cloud.route: example.net

networks:
  system:
